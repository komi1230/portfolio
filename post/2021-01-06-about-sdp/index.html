<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Launch Today"><meta property="og:type" content="article"><meta property="og:url" content="https://komi.dev/"><meta property="og:locale" content="ja_JP"><meta name=twitter:site content="@komi_edtr_1230"><meta property="og:image" content="http://komi.dev/img/home.jpg"><meta property="twitter:image" content="http://komi.dev/img/home.jpg"><meta name=title content="WebRTCにおけるSDPを理解する"><meta property="og:title" content="WebRTCにおけるSDPを理解する"><meta property="twitter:title" content="WebRTCにおけるSDPを理解する"><meta name=description content="WebRTCでは通信条件のネゴシエーションが必要だが、これを実現するためにSDPがある。ここではSDPがどのような形をしているかを見ていく。"><meta property="og:description" content="WebRTCでは通信条件のネゴシエーションが必要だが、これを実現するためにSDPがある。ここではSDPがどのような形をしているかを見ていく。"><meta property="twitter:description" content="WebRTCでは通信条件のネゴシエーションが必要だが、これを実現するためにSDPがある。ここではSDPがどのような形をしているかを見ていく。"><meta property="twitter:card" content="summary"><meta name=keyword content="Yusuke Kominami, 小南佑介, 小南 佑介, Rust, Emacs, Lisp, Web, Machine Learning, 機械学習"><link rel="shortcut icon" href=/img/favicon.ico><title>WebRTCにおけるSDPを理解する</title><link rel=canonical href=/post/2021-01-06-about-sdp/><link rel=stylesheet href=/css/iDisqus.min.css><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hux-blog.min.css><link rel=stylesheet href=/css/zanshang.css><link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=stylesheet href=http://komi.dev/css/custom-font.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-177061519-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-177061519-1');</script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=/>Launch Today</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>Home</a></li><li><a href=/categories/tech>tech</a></li><li><a href=/top/about/>ABOUT</a></li><li><a href=/search>SEARCH <img src=/img/search.png height=15 style=cursor:pointer alt=Search></a></li></ul></div></div></div></nav><script>var $body=document.body;var $toggle=document.querySelector('.navbar-toggle');var $navbar=document.querySelector('#huxblog_navbar');var $collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic)
function handleMagic(e){if($navbar.className.indexOf('in')>0){$navbar.className=" ";setTimeout(function(){if($navbar.className.indexOf('in')<0){$collapse.style.height="0px"}},400)}else{$collapse.style.height="auto"
$navbar.className+=" in";}}</script><style type=text/css>header.intro-header{background-image:url(https://news.1242.com/wp-content/uploads/2016/12/66b202f80d34b97d35539aa73b12f564_sw680.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/webrtc title=WebRTC>WebRTC</a>
<a class=tag href=/tags/sdp title=SDP>SDP</a></div><h1>WebRTCにおけるSDPを理解する</h1><h2 class=subheading>SDPによってオファー/アンサーモデルがどのように構築されているかを見る</h2><span class=meta>Posted
on
Wednesday, January 6, 2021</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-11 col-lg-offset-1
col-md-10 col-md-offset-1
post-container"><header><h2>TOC</h2></header><nav id=TableOfContents><ul><li><a href=#モチベーション>モチベーション</a></li><li><a href=#sdpとは>SDPとは</a><ul><li><a href=#オファーアンサーモデル>オファーアンサーモデル</a></li></ul></li><li><a href=#仕様を眺めてみる>仕様を眺めてみる</a></li></ul></nav><h1 id=モチベーション>モチベーション</h1><p>最近はWebRTCにハマっていて、別に何か作りたいものがあったからというわけでは無いのだけど単純に面白いから見ており、それに際してその周辺技術にぼちぼちコミットしたりしている(<a href=https://github.com/mozilla/webrtc-sdp/pull/232>こんな感じ</a>)。</p><p>ただ実際のところは本当に趣味といった具合なので詳細な部分についてはまだまだ勉強中だったりする。</p><p>そんなわけでこの記事はある程度理解が進んだSDPについての勉強メモみたいな感じ。</p><h1 id=sdpとは>SDPとは</h1><p>まず最初にSDPとググるとだいたいゼロトラストの方のSDPが出てくる。</p><p>ゼロトラストのSDPはSoftware Defined Perimeterの略語で、WebRTCのSDPとは全くの別物であることに注意(ただ、WebRTCはP2P通信でファイアウォールなどのネットワークの壁をどう越えるかみたいなところが結構大変で、そこらへんの概念にゼロトラストのSDPみたいな考え方が出てきたりするので無関係というわけではなさそうだけども&mldr;)。</p><p>とりあえず今回の記事ではSDPとはSession Description Protocolだと最初に断っておきたい。</p><h2 id=オファーアンサーモデル>オファーアンサーモデル</h2><p>さて、WebRTCにおけるSDPの話というわけだけど、WebRTCはP2P通信で、クライアントとクライアントが通信することになる。</p><p>何を通信するかというと、音声だったりテキストだったり画像とか動画。
ただ、前提として各クライアントがどのメディアを使えるかはお互いに確認してみないと分からないのである。</p><p>そこでお互いが何のメディアを使えるかを伝え合う所作を<strong>オファーアンサーモデル</strong>という。</p><p>具体的には</p><pre><code>アリス「こっち電話とビデオいけるけどそっちどうよ？」

ボブ「あーこっち電話しか使えないんだわ」
</code></pre><p>的なやり取りである。</p><h1 id=仕様を眺めてみる>仕様を眺めてみる</h1><p>SDPがP2P通信においてお互いがどのメディアを使用可能か確認するお作法であることはわかったので、具体的にどのようにやっていくかを見ていく。</p><p>クライアント間では以下のようなデータがやり取りされる。</p><pre><code>v=0
o=jdoe 2890844526 2890842807 IN IP4 10.47.16.5
s=SDP Seminar
i=A Seminar on the session description protocol
u=http://www.example.com/seminars/sdp.pdf
e=j.doe@example.com (Jane Doe)
c=IN IP4 224.2.17.12/127
t=2873397496 2873404696
a=recvonly
m=audio 49170 RTP/AVP 0
m=video 51372 RTP/AVP 99
a=rtpmap:99 h263-1998/90000
</code></pre><p>この<code>v=</code>とかみたいなのはSDPにおけるDSLみたいなもので、それぞれがセッション情報だったり扱えるメディアについての情報、どのポート番号を解放するかなどを表している。</p><p>簡単にいくと</p><ul><li>v= : セッションのバージョン番号。基本的に0で固定。</li><li>o= : 送信元の情報。</li><li>s= : セッション名。</li><li>i= : セッション情報。</li><li>u= : URI</li><li>e= : メールアドレス。<code>p=</code>で電話番号が書かれることも。</li><li>c= : 接続データ。</li><li>b= : 帯域。</li><li>t= : タイミング、時間。スタートと終わりがUnixタイムで表現される。</li><li>r= : 繰り返し回数</li><li>z= : タイムゾーン</li><li>k= : 暗号化キー</li><li>a= : 属性情報、セッションの拡張情報</li><li>m= : メディア記述</li></ul><p>という具合。</p><p>これらは全部が必須というわけではなくオプションのものもあるが、SDPの記述においてはいくつかの制約があったりする。</p><p>具体的に言うと、例えば<code>v=0</code>などでは途中に空白を入れてはいけないことや、<code>v</code>や<code>o</code>などの出現順序を間違えてはいけないことなどがある。</p><p>詳しい話は<a href=https://www.slideshare.net/iwashi86/webrtc-for-sdp>このSlideshare</a>がめちゃくちゃわかりやすく解説してあるが、これの補足をいくつかしておく。</p><ul><li><code>m=</code>行の数のオファーとアンサーで同一でなければいけないけど、互いに扱えるメディアの数が違う時はどうするの？<ul><li>該当するメディアのポート番号を0として解放しない旨を示す</li></ul></li><li>行の並びが指定されているけど<code>m=</code>が複数並んでる時は順序指定ってある？<ul><li><code>audio</code>を優先的に上にする。</li></ul></li></ul><p>ここら辺の仕様書は<a href=https://www.ttc.or.jp/application/files/3715/5442/4950/TS-1009v1.pdf>情報通信技術委員会が作ったもの</a>が参考になるので確認しよう。</p><p>また一番詳しいのは<a href=https://tools.ietf.org/html/rfc4566>RFC4566</a>なのでこれを読もう。</p><hr><ul class=pager><li class=next><a href=http://komi.dev/post/2021-01-19-cloud-run-from-github-actions/ data-toggle=tooltip data-placement=top title="GitHub ActionsからCloud Runを叩く">Next
Post &rarr;</a></li></ul><div id=disqus-comment></div></div><div class="col-lg-11 col-lg-offset-1
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href rel=alternate type=application/rss+xml title="Launch Today"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li><a href=mailto:yusuke.kominami@gmail.com><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/komi_edtr_1230><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.facebook.com/1230komi/><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/komi1230><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yusuke-kominami-0419b1157/><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/12464570><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Launch Today 2021</p></div></div></div></footer><script>function async(u,c){var d=document,t='script',o=d.createElement(t),s=d.getElementsByTagName(t)[0];o.src=u;if(c){o.addEventListener('load',function(e){c(null,e);},false);}
s.parentNode.insertBefore(o,s);}</script><script>if($('#tag_cloud').length!==0){async("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:'#bbbbee',end:'#0085a1'},};$('#tag_cloud a').tagcloud();})}</script><script>async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js",function(){var $nav=document.querySelector("nav");if($nav)FastClick.attach($nav);})</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-177061519-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>